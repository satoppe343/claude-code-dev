{
  "name": "claude-code-dev",
  "dockerComposeFile": "docker-compose.yml",
  "service": "dev",
  "workspaceFolder": "/workspace",
  "remoteUser": "node",
  "features": {
    // Oh My Zsh: zsh 本体は Dockerfile でインストール済みのため installZsh: false
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": false,
      "configureZshAsDefaultShell": false,
      "installOhMyZsh": true,
      "installOhMyZshConfig": true,
      "upgradePackages": false
    },
    // Starship: powerlevel10k (メンテナンスモード) の後継プロンプト
    "ghcr.io/schlich/devcontainer-features/starship:0": {},
    // Claude Code: Feature 方式でインストール (Dockerfile との関心分離)
    "ghcr.io/anthropics/devcontainer-features/claude-code:1": {}
  },
  "customizations": {
    "vscode": {
      "extensions": ["dbaeumer.vscode-eslint", "esbenp.prettier-vscode"],
      "settings": {
        "editor.fontFamily": "'JetBrains Mono', Consolas, 'Courier New', monospace",
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "editor.codeActionsOnSave": {
          "source.fixAll.eslint": "explicit"
        },
        // initializeCommand 完了後のターミナルを自動終了
        "terminal.integrated.enablePersistentSessions": false,
        "terminal.integrated.defaultProfile.linux": "zsh",
        "terminal.integrated.profiles.linux": {
          "bash": { "path": "bash", "icon": "terminal-bash" },
          "zsh": { "path": "zsh" }
        }
      }
    }
  },
  // initializeCommand: ホスト側で実行。macOS キーチェーンからトークンを取得
  "initializeCommand": ".devcontainer/load-secrets.sh",
  // postCreateCommand: コンテナ作成後に実行。zsh プラグイン + Starship 設定
  "postCreateCommand": "/workspace/.devcontainer/post-create-command.sh",
  // postStartCommand: コンテナ起動ごとに実行。認証情報注入 + ファイアウォール設定
  "postStartCommand": "/workspace/.devcontainer/post-start-command.sh",
  // ファイアウォール設定完了まで操作を待機
  "waitFor": "postStartCommand"
}
